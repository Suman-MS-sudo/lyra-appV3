{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///E:/lyra-app-v3/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies();\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll();\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            );\r\n          } catch {\r\n            // Server Component - cookies().set() will fail\r\n          }\r\n        },\r\n      },\r\n    }\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,+CAA+C;gBACjD;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///E:/lyra-app-v3/src/app/admin/users/page.tsx"],"sourcesContent":["import { redirect } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createClient as createServiceClient } from '@supabase/supabase-js';\r\nimport { UserPlus, Users, Shield, User, Building2, ArrowLeft, Pencil, Trash2 } from 'lucide-react';\r\n\r\nexport default async function UsersPage() {\r\n  const supabase = await createClient();\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (!user) {\r\n    redirect('/login');\r\n  }\r\n\r\n  // Use service role to fetch all data including profile check\r\n  const serviceSupabase = createServiceClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n  );\r\n\r\n  // Check if user is admin using service role to bypass RLS\r\n  const { data: profile } = await serviceSupabase\r\n    .from('profiles')\r\n    .select('role, account_type')\r\n    .eq('id', user.id)\r\n    .single();\r\n\r\n  // Only allow admins\r\n  if (profile?.role !== 'admin') {\r\n    redirect('/customer/dashboard');\r\n  }\r\n\r\n  // Fetch all users\r\n  const { data: users, error } = await serviceSupabase\r\n    .from('profiles')\r\n    .select('id, email, role, account_type, organization_id, created_at')\r\n    .in('account_type', ['customer', 'super_customer', 'admin'])\r\n    .order('created_at', { ascending: false });\r\n\r\n  if (error) {\r\n    console.error('Error fetching users:', error);\r\n  }\r\n\r\n  // Fetch organization names separately if needed\r\n  const orgIds = users?.map(u => u.organization_id).filter(Boolean) || [];\r\n  let organizations: any[] = [];\r\n  if (orgIds.length > 0) {\r\n    const { data: orgs } = await serviceSupabase\r\n      .from('organizations')\r\n      .select('id, name')\r\n      .in('id', orgIds);\r\n    organizations = orgs || [];\r\n  }\r\n\r\n  // Map organization names to users\r\n  const usersWithOrgs = users?.map(u => ({\r\n    ...u,\r\n    organizations: organizations.find(o => o.id === u.organization_id)\r\n  })) || [];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <header className=\"bg-white border-b\">\r\n        <div className=\"px-6 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <Link href=\"/admin/dashboard\" className=\"p-2 hover:bg-gray-100 rounded-lg\">\r\n                <ArrowLeft className=\"h-5 w-5\" />\r\n              </Link>\r\n              <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">All Users</h1>\r\n                <p className=\"text-sm text-gray-500\">Manage normal users and super users (organizations)</p>\r\n              </div>\r\n            </div>\r\n            <Link\r\n              href=\"/admin/users/new\"\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all\"\r\n            >\r\n              <UserPlus className=\"h-4 w-4\" />\r\n              Add User\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"container mx-auto px-6 py-8\">\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n\r\n          {/* Stats Summary */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 p-6 border-b border-gray-200\">\r\n            <div className=\"bg-blue-50 rounded-lg p-6 border border-blue-100\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"p-3 bg-blue-100 rounded-lg\">\r\n                  <User className=\"h-6 w-6 text-blue-600\" />\r\n                </div>\r\n                <div>\r\n                  <div className=\"text-sm text-gray-600\">Normal Users</div>\r\n                  <div className=\"text-3xl font-bold text-gray-900\">\r\n                    {usersWithOrgs?.filter(u => u.account_type === 'customer').length || 0}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-purple-50 rounded-lg p-6 border border-purple-100\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"p-3 bg-purple-100 rounded-lg\">\r\n                  <Building2 className=\"h-6 w-6 text-purple-600\" />\r\n                </div>\r\n                <div>\r\n                  <div className=\"text-sm text-gray-600\">Super Users (Organizations)</div>\r\n                  <div className=\"text-3xl font-bold text-gray-900\">\r\n                    {usersWithOrgs?.filter(u => u.account_type === 'super_customer').length || 0}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-green-50 rounded-lg p-6 border border-green-100\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"p-3 bg-green-100 rounded-lg\">\r\n                  <Shield className=\"h-6 w-6 text-green-600\" />\r\n                </div>\r\n                <div>\r\n                  <div className=\"text-sm text-gray-600\">Admin Users</div>\r\n                  <div className=\"text-3xl font-bold text-gray-900\">\r\n                    {usersWithOrgs?.filter(u => u.account_type === 'admin').length || 0}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Users Table */}\r\n          <div className=\"p-6\">\r\n            {!usersWithOrgs || usersWithOrgs.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Users className=\"h-12 w-12 text-gray-300 mx-auto mb-4\" />\r\n                <p className=\"text-gray-500\">No users found</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-gray-200 bg-gray-50\">\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        User\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        Type\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        Organization\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        Role\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        Joined\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\r\n                        Actions\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"divide-y divide-gray-100\">\r\n                    {usersWithOrgs.map((user: any) => (\r\n                      <tr\r\n                        key={user.id}\r\n                        className=\"hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <td className=\"px-6 py-4\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${\r\n                              user.account_type === 'admin'\r\n                                ? 'bg-gradient-to-br from-green-500 to-green-600'\r\n                                : user.account_type === 'super_customer' \r\n                                ? 'bg-gradient-to-br from-purple-500 to-purple-600' \r\n                                : 'bg-gradient-to-br from-blue-500 to-blue-600'\r\n                            }`}>\r\n                              {user.account_type === 'admin' ? (\r\n                                <Shield className=\"h-5 w-5\" />\r\n                              ) : user.account_type === 'super_customer' ? (\r\n                                <Building2 className=\"h-5 w-5\" />\r\n                              ) : (\r\n                                <User className=\"h-5 w-5\" />\r\n                              )}\r\n                            </div>\r\n                            <div>\r\n                              <div className=\"font-medium text-gray-900\">{user.email}</div>\r\n                              <div className=\"text-xs text-gray-500\">{user.id.substring(0, 8)}...</div>\r\n                            </div>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold ${\r\n                            user.account_type === 'admin'\r\n                              ? 'bg-green-100 text-green-700 border border-green-200'\r\n                              : user.account_type === 'super_customer'\r\n                              ? 'bg-purple-100 text-purple-700 border border-purple-200'\r\n                              : 'bg-blue-100 text-blue-700 border border-blue-200'\r\n                          }`}>\r\n                            {user.account_type === 'admin' ? (\r\n                              <>\r\n                                <Shield className=\"h-3 w-3\" />\r\n                                Admin\r\n                              </>\r\n                            ) : user.account_type === 'super_customer' ? (\r\n                              <>\r\n                                <Building2 className=\"h-3 w-3\" />\r\n                                Super User\r\n                              </>\r\n                            ) : (\r\n                              <>\r\n                                <User className=\"h-3 w-3\" />\r\n                                Normal User\r\n                              </>\r\n                            )}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          {user.organizations?.name ? (\r\n                            <span className=\"text-sm font-medium text-gray-900\">\r\n                              {user.organizations.name}\r\n                            </span>\r\n                          ) : (\r\n                            <span className=\"text-sm text-gray-400\">-</span>\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <span className=\"text-sm text-gray-600 capitalize\">{user.role}</span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <span className=\"text-sm text-gray-600\">\r\n                            {new Date(user.created_at).toLocaleDateString('en-US', {\r\n                              year: 'numeric',\r\n                              month: 'short',\r\n                              day: 'numeric'\r\n                            })}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Link\r\n                              href={`/admin/users/${user.id}/edit`}\r\n                              className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                              title=\"Edit user\"\r\n                            >\r\n                              <Pencil className=\"h-4 w-4\" />\r\n                            </Link>\r\n                            <button\r\n                              className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                              title=\"Delete user\"\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </button>\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}