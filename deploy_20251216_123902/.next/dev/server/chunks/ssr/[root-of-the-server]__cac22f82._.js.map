{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///E:/lyra-app-v3/src/components/PaymentForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\ninterface PaymentFormProps {\r\n  invoiceId: string;\r\n  amount: number;\r\n  invoiceNumber: string;\r\n  organizationName: string;\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    Razorpay: any;\r\n  }\r\n}\r\n\r\nexport default function PaymentForm({ \r\n  invoiceId, \r\n  amount, \r\n  invoiceNumber,\r\n  organizationName \r\n}: PaymentFormProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    // Load Razorpay script\r\n    const script = document.createElement('script');\r\n    script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n    script.async = true;\r\n    document.body.appendChild(script);\r\n\r\n    return () => {\r\n      document.body.removeChild(script);\r\n    };\r\n  }, []);\r\n\r\n  const handlePayment = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Create Razorpay order\r\n      const orderResponse = await fetch('/api/billing/create-order', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ invoiceId }),\r\n      });\r\n\r\n      if (!orderResponse.ok) {\r\n        const errorData = await orderResponse.json();\r\n        throw new Error(errorData.error || 'Failed to create order');\r\n      }\r\n\r\n      const orderData = await orderResponse.json();\r\n\r\n      // Initialize Razorpay payment\r\n      const options = {\r\n        key: orderData.keyId,\r\n        amount: orderData.amount,\r\n        currency: orderData.currency,\r\n        name: 'Lyra',\r\n        description: `Payment for Invoice ${orderData.invoiceNumber}`,\r\n        order_id: orderData.orderId,\r\n        handler: async function (response: any) {\r\n          try {\r\n            // Verify payment on backend\r\n            const verifyResponse = await fetch('/api/billing/verify-payment', {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify({\r\n                razorpay_order_id: response.razorpay_order_id,\r\n                razorpay_payment_id: response.razorpay_payment_id,\r\n                razorpay_signature: response.razorpay_signature,\r\n              }),\r\n            });\r\n\r\n            if (verifyResponse.ok) {\r\n              // Payment successful - redirect to billing page\r\n              router.push('/admin/billing?payment=success');\r\n            } else {\r\n              throw new Error('Payment verification failed');\r\n            }\r\n          } catch (err: any) {\r\n            setError(err.message || 'Payment verification failed');\r\n            setLoading(false);\r\n          }\r\n        },\r\n        prefill: {\r\n          name: organizationName,\r\n        },\r\n        theme: {\r\n          color: '#3B82F6',\r\n        },\r\n        modal: {\r\n          ondismiss: function() {\r\n            setLoading(false);\r\n          }\r\n        }\r\n      };\r\n\r\n      const rzp = new window.Razorpay(options);\r\n      \r\n      rzp.on('payment.failed', function (response: any) {\r\n        setError(`Payment failed: ${response.error.description}`);\r\n        setLoading(false);\r\n      });\r\n\r\n      rzp.open();\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to initiate payment');\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <p className=\"text-red-800 text-sm\">{error}</p>\r\n        </div>\r\n      )}\r\n\r\n      <button\r\n        onClick={handlePayment}\r\n        disabled={loading}\r\n        className=\"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold\"\r\n      >\r\n        {loading ? 'Processing...' : `Pay ₹${(amount / 100).toFixed(2)}`}\r\n      </button>\r\n\r\n      <div className=\"text-center text-sm text-gray-500\">\r\n        <p>Secure payment powered by Razorpay</p>\r\n        <p className=\"mt-1\">UPI • Cards • Net Banking • Wallets</p>\r\n      </div>\r\n\r\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800\">\r\n        <p className=\"font-semibold mb-2\">Payment Instructions:</p>\r\n        <ul className=\"list-disc list-inside space-y-1\">\r\n          <li>Click \"Pay\" button above to open payment gateway</li>\r\n          <li>Choose your preferred payment method (UPI, Card, etc.)</li>\r\n          <li>Complete the payment</li>\r\n          <li>Payment status will be updated automatically</li>\r\n          <li>You will be redirected back after successful payment</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}