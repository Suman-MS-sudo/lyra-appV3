{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/lyra-app-v3/src/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\r\n\r\n// Create reusable transporter\r\nconst transporter = nodemailer.createTransport({\r\n  host: process.env.SMTP_HOST,\r\n  port: parseInt(process.env.SMTP_PORT || '465'),\r\n  secure: process.env.SMTP_SECURE === 'true', // true for 465 (SSL), false for 587 (TLS)\r\n  auth: {\r\n    user: process.env.SMTP_USER,\r\n    pass: process.env.SMTP_PASSWORD,\r\n  },\r\n  debug: true, // Enable debug output\r\n  logger: true // Log to console\r\n});\r\n\r\nexport interface EmailOptions {\r\n  to: string | string[];\r\n  subject: string;\r\n  html?: string;\r\n  text?: string;\r\n  attachments?: Array<{\r\n    filename: string;\r\n    content?: string | Buffer;\r\n    path?: string;\r\n  }>;\r\n}\r\n\r\nexport async function sendEmail(options: EmailOptions) {\r\n  try {\r\n    const info = await transporter.sendMail({\r\n      from: `\"${process.env.SMTP_FROM_NAME}\" <${process.env.SMTP_FROM_EMAIL}>`,\r\n      to: Array.isArray(options.to) ? options.to.join(', ') : options.to,\r\n      subject: options.subject,\r\n      text: options.text,\r\n      html: options.html,\r\n      attachments: options.attachments,\r\n    });\r\n\r\n    console.log('Email sent:', info.messageId);\r\n    return { success: true, messageId: info.messageId };\r\n  } catch (error: any) {\r\n    console.error('Email sending failed:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\n// Template for invoice email\r\nexport function generateInvoiceEmailHTML(data: {\r\n  invoiceNumber: string;\r\n  organizationName: string;\r\n  totalAmount: string;\r\n  dueDate: string;\r\n  invoiceUrl: string;\r\n  paymentUrl: string;\r\n  totalAmountPaisa?: number;\r\n}) {\r\n  const isZeroAmount = data.totalAmountPaisa === 0 || data.totalAmount === '‚Çπ0.00';\r\n  \r\n  return `\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Invoice ${data.invoiceNumber}</title>\r\n</head>\r\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\r\n    <h1 style=\"color: white; margin: 0;\">Lyra Enterprises</h1>\r\n    <p style=\"color: #f0f0f0; margin: 10px 0 0 0;\">Vending Machine Solutions</p>\r\n  </div>\r\n  \r\n  <div style=\"background: #f9f9f9; padding: 30px; border: 1px solid #ddd; border-top: none;\">\r\n    <h2 style=\"color: #667eea; margin-top: 0;\">${isZeroAmount ? 'Monthly Statement' : 'New Invoice'}: ${data.invoiceNumber}</h2>\r\n    \r\n    <p>Dear ${data.organizationName},</p>\r\n    \r\n    ${isZeroAmount ? `\r\n    <p>We hope this email finds you well. This is your monthly statement for the billing period.</p>\r\n    \r\n    <div style=\"background: #e8f5e9; padding: 20px; border-left: 4px solid #4caf50; margin: 20px 0; border-radius: 5px;\">\r\n      <h3 style=\"margin-top: 0; color: #2e7d32;\">‚úì No Payment Pending</h3>\r\n      <p style=\"margin: 10px 0 0 0; font-size: 16px;\">We're pleased to inform you that there are no pending payments for this period. No vending machine transactions were recorded during this billing cycle.</p>\r\n    </div>\r\n    \r\n    <div style=\"background: white; padding: 20px; border-left: 4px solid #667eea; margin: 20px 0;\">\r\n      <h3 style=\"margin-top: 0; color: #667eea;\">Statement Details</h3>\r\n      <table style=\"width: 100%; border-collapse: collapse;\">\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Statement Number:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.invoiceNumber}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Total Amount:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: #4caf50; font-size: 18px; font-weight: bold;\">${data.totalAmount}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Status:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: #4caf50; font-weight: bold;\">No Payment Required</td>\r\n        </tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div style=\"text-align: center; margin: 30px 0;\">\r\n      <a href=\"${data.invoiceUrl}\" style=\"display: inline-block; background: #667eea; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold;\">View Statement</a>\r\n    </div>\r\n    \r\n    <p style=\"color: #666; font-size: 14px; margin-top: 30px;\">Thank you for your continued partnership with Lyra Enterprises. We look forward to serving you in the coming months.</p>\r\n    ` : `\r\n    <p>We hope this email finds you well. A new invoice has been generated for your account.</p>\r\n    \r\n    <div style=\"background: white; padding: 20px; border-left: 4px solid #667eea; margin: 20px 0;\">\r\n      <h3 style=\"margin-top: 0; color: #667eea;\">Invoice Details</h3>\r\n      <table style=\"width: 100%; border-collapse: collapse;\">\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Invoice Number:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.invoiceNumber}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Total Amount:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: #667eea; font-size: 18px; font-weight: bold;\">${data.totalAmount}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Due Date:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.dueDate}</td>\r\n        </tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div style=\"text-align: center; margin: 30px 0;\">\r\n      <a href=\"${data.paymentUrl}\" style=\"display: inline-block; background: #667eea; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; margin: 0 10px;\">Pay Now</a>\r\n      <a href=\"${data.invoiceUrl}\" style=\"display: inline-block; background: white; color: #667eea; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; border: 2px solid #667eea; margin: 0 10px;\">View Invoice</a>\r\n    </div>\r\n    \r\n    <p style=\"color: #666; font-size: 14px; margin-top: 30px;\">If you have any questions regarding this invoice, please don't hesitate to contact our billing department.</p>\r\n    `}\r\n    \r\n    <hr style=\"border: none; border-top: 1px solid #ddd; margin: 30px 0;\">\r\n    \r\n    <div style=\"text-align: center; color: #999; font-size: 12px;\">\r\n      <p><strong>Lyra Enterprises</strong></p>\r\n      <p>10/21, Vasuki Street, Cholapuram<br>Ambattur, Chennai - 600053</p>\r\n      <p>+91 81223 78860 | lyraenterprisessales@gmail.com</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n  `;\r\n}\r\n\r\n// Template for payment confirmation email\r\nexport function generatePaymentConfirmationHTML(data: {\r\n  invoiceNumber: string;\r\n  organizationName: string;\r\n  paidAmount: string;\r\n  paymentId: string;\r\n  paidDate: string;\r\n  invoiceUrl: string;\r\n}) {\r\n  return `\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Payment Received</title>\r\n</head>\r\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n  <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\r\n    <h1 style=\"color: white; margin: 0;\">‚úì Payment Received</h1>\r\n    <p style=\"color: #f0f0f0; margin: 10px 0 0 0;\">Thank you for your payment!</p>\r\n  </div>\r\n  \r\n  <div style=\"background: #f9f9f9; padding: 30px; border: 1px solid #ddd; border-top: none;\">\r\n    <p>Dear ${data.organizationName},</p>\r\n    \r\n    <p>We have successfully received your payment for Invoice ${data.invoiceNumber}.</p>\r\n    \r\n    <div style=\"background: white; padding: 20px; border-left: 4px solid #10b981; margin: 20px 0;\">\r\n      <h3 style=\"margin-top: 0; color: #10b981;\">Payment Details</h3>\r\n      <table style=\"width: 100%; border-collapse: collapse;\">\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Invoice Number:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.invoiceNumber}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Amount Paid:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: #10b981; font-size: 18px; font-weight: bold;\">${data.paidAmount}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Payment Date:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.paidDate}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Payment ID:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; font-family: monospace; font-size: 12px;\">${data.paymentId}</td>\r\n        </tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div style=\"text-align: center; margin: 30px 0;\">\r\n      <a href=\"${data.invoiceUrl}\" style=\"display: inline-block; background: #10b981; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold;\">View Invoice</a>\r\n    </div>\r\n    \r\n    <p style=\"color: #666; font-size: 14px; margin-top: 30px;\">Thank you for your business. We appreciate your prompt payment!</p>\r\n    \r\n    <hr style=\"border: none; border-top: 1px solid #ddd; margin: 30px 0;\">\r\n    \r\n    <div style=\"text-align: center; color: #999; font-size: 12px;\">\r\n      <p><strong>Lyra Enterprises</strong></p>\r\n      <p>10/21, Vasuki Street, Cholapuram<br>Ambattur, Chennai - 600053</p>\r\n      <p>+91 81223 78860 | lyraenterprisessales@gmail.com</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n  `;\r\n}\r\n\r\n// Template for payment reminder\r\nexport function generatePaymentReminderHTML(data: {\r\n  invoiceNumber: string;\r\n  organizationName: string;\r\n  dueAmount: string;\r\n  dueDate: string;\r\n  daysOverdue?: number;\r\n  invoiceUrl: string;\r\n  paymentUrl: string;\r\n}) {\r\n  const isOverdue = data.daysOverdue && data.daysOverdue > 0;\r\n  \r\n  return `\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Payment Reminder</title>\r\n</head>\r\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n  <div style=\"background: ${isOverdue ? 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)' : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'}; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\r\n    <h1 style=\"color: white; margin: 0;\">${isOverdue ? '‚ö†Ô∏è Payment Overdue' : 'üîî Payment Reminder'}</h1>\r\n    <p style=\"color: #f0f0f0; margin: 10px 0 0 0;\">${isOverdue ? 'Immediate attention required' : 'Payment due soon'}</p>\r\n  </div>\r\n  \r\n  <div style=\"background: #f9f9f9; padding: 30px; border: 1px solid #ddd; border-top: none;\">\r\n    <p>Dear ${data.organizationName},</p>\r\n    \r\n    <p>${isOverdue \r\n      ? `This is a reminder that your invoice ${data.invoiceNumber} is now <strong>${data.daysOverdue} days overdue</strong>. Please make the payment as soon as possible to avoid any service interruption.`\r\n      : `This is a friendly reminder that your invoice ${data.invoiceNumber} is pending payment.`\r\n    }</p>\r\n    \r\n    <div style=\"background: white; padding: 20px; border-left: 4px solid ${isOverdue ? '#ef4444' : '#f59e0b'}; margin: 20px 0;\">\r\n      <h3 style=\"margin-top: 0; color: ${isOverdue ? '#ef4444' : '#f59e0b'};\">Outstanding Invoice</h3>\r\n      <table style=\"width: 100%; border-collapse: collapse;\">\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Invoice Number:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.invoiceNumber}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Amount Due:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: ${isOverdue ? '#ef4444' : '#f59e0b'}; font-size: 18px; font-weight: bold;\">${data.dueAmount}</td>\r\n        </tr>\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Due Date:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right;\">${data.dueDate}</td>\r\n        </tr>\r\n        ${isOverdue ? `\r\n        <tr>\r\n          <td style=\"padding: 8px 0;\"><strong>Days Overdue:</strong></td>\r\n          <td style=\"padding: 8px 0; text-align: right; color: #ef4444; font-weight: bold;\">${data.daysOverdue} days</td>\r\n        </tr>\r\n        ` : ''}\r\n      </table>\r\n    </div>\r\n    \r\n    <div style=\"text-align: center; margin: 30px 0;\">\r\n      <a href=\"${data.paymentUrl}\" style=\"display: inline-block; background: ${isOverdue ? '#ef4444' : '#f59e0b'}; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; margin: 0 10px;\">Pay Now</a>\r\n      <a href=\"${data.invoiceUrl}\" style=\"display: inline-block; background: white; color: ${isOverdue ? '#ef4444' : '#f59e0b'}; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; border: 2px solid ${isOverdue ? '#ef4444' : '#f59e0b'}; margin: 0 10px;\">View Invoice</a>\r\n    </div>\r\n    \r\n    <p style=\"color: #666; font-size: 14px; margin-top: 30px;\">If you have already made the payment, please disregard this reminder. If you're facing any issues with payment, please contact our billing department immediately.</p>\r\n    \r\n    <hr style=\"border: none; border-top: 1px solid #ddd; margin: 30px 0;\">\r\n    \r\n    <div style=\"text-align: center; color: #999; font-size: 12px;\">\r\n      <p><strong>Lyra Enterprises</strong></p>\r\n      <p>10/21, Vasuki Street, Cholapuram<br>Ambattur, Chennai - 600053</p>\r\n      <p>+91 81223 78860 | lyraenterprisessales@gmail.com</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n  `;\r\n}\r\n"],"names":[],"mappings":"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"}}]
}