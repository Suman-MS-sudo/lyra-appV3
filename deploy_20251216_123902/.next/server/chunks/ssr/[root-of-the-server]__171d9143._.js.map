{"version":3,"sources":["../../../../src/components/EditUserMachines.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/customer/users/%5BuserId%5D/edit/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/EditUserMachines.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/EditUserMachines.tsx\",\n    \"default\",\n);\n","import { redirect } from 'next/navigation';\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createClient as createServiceClient } from '@supabase/supabase-js';\r\nimport Link from 'next/link';\r\nimport EditUserMachines from '@/components/EditUserMachines';\r\n\r\nexport default async function EditUserPage({ params }: { params: Promise<{ userId: string }> }) {\r\n  const { userId } = await params;\r\n  const supabase = await createClient();\r\n  \r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (!user) {\r\n    redirect('/login');\r\n  }\r\n\r\n  const serviceSupabase = createServiceClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n  );\r\n\r\n  // Fetch current user profile\r\n  const { data: profile } = await serviceSupabase\r\n    .from('profiles')\r\n    .select('*')\r\n    .eq('id', user.id)\r\n    .single();\r\n\r\n  if (profile?.account_type !== 'super_customer') {\r\n    redirect('/customer/dashboard');\r\n  }\r\n\r\n  // Fetch user to edit\r\n  const { data: userToEdit } = await serviceSupabase\r\n    .from('profiles')\r\n    .select('*')\r\n    .eq('id', userId)\r\n    .single();\r\n\r\n  if (!userToEdit || userToEdit.organization_id !== profile.organization_id) {\r\n    redirect('/customer/users');\r\n  }\r\n\r\n  // Fetch ALL machines (both owned by super customer and assigned to this user)\r\n  const { data: allMachines } = await serviceSupabase\r\n    .from('vending_machines')\r\n    .select('id, name, location, customer_id')\r\n    .or(`customer_id.eq.${user.id},customer_id.eq.${userId}`)\r\n    .order('name');\r\n\r\n  // Separate machines by ownership\r\n  const ownedMachines = allMachines?.filter(m => m.customer_id === user.id) || [];\r\n  const assignedMachines = allMachines?.filter(m => m.customer_id === userId) || [];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50\">\r\n      <header className=\"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-50 shadow-sm\">\r\n        <div className=\"px-6 py-4 flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className=\"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg\"></div>\r\n            <h1 className=\"text-xl font-bold text-gray-900\">Lyra</h1>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"container mx-auto px-6 py-8 max-w-2xl\">\r\n        <div className=\"mb-6\">\r\n          <Link href=\"/customer/users\" className=\"text-blue-600 hover:text-blue-700 text-sm font-medium\">\r\n            ← Back to Users\r\n          </Link>\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mt-2\">Edit User</h2>\r\n          <p className=\"text-sm text-gray-600\">Update user information and machine assignments</p>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6 space-y-6\">\r\n          {/* User Info */}\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">User Information</h3>\r\n            <div className=\"space-y-3\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-700\">Email</label>\r\n                <div className=\"text-gray-900 mt-1\">{userToEdit.email}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-700\">Full Name</label>\r\n                <div className=\"text-gray-900 mt-1\">{userToEdit.full_name || 'Not set'}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-700\">Phone</label>\r\n                <div className=\"text-gray-900 mt-1\">{userToEdit.phone || 'Not set'}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-700\">Role</label>\r\n                <div className=\"text-gray-900 mt-1\">\r\n                  <span className=\"inline-block px-2 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700\">\r\n                    {userToEdit.role}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Machine Assignment */}\r\n          <div className=\"border-t pt-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Machine Management</h3>\r\n            <p className=\"text-sm text-gray-600 mb-4\">\r\n              Assign specific machines to this user. Assigned machines will be owned and managed by them.\r\n            </p>\r\n            \r\n            <EditUserMachines \r\n              userId={userId}\r\n              superCustomerId={user.id}\r\n              ownedMachines={ownedMachines}\r\n              assignedMachines={assignedMachines}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\r\n            <h4 className=\"text-sm font-semibold text-gray-900 mb-2\">Access Permissions</h4>\r\n            <ul className=\"text-sm text-gray-600 space-y-1\">\r\n              <li>✓ View all machines in the organization</li>\r\n              <li>✓ See revenue and transaction data</li>\r\n              <li>✓ Access customer dashboard</li>\r\n              <li>✗ Cannot create or manage users</li>\r\n              <li>✗ Cannot access admin features</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}