module.exports=[77678,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(95936),e=a.i(16349),f=a.i(51100),g=a.i(13743),h=a.i(36361),i=a.i(52132),j=a.i(87953),k=a.i(11070),l=a.i(74091),m=a.i(46840);async function n(){let a=await (0,e.createClient)(),{data:{user:n}}=await a.auth.getUser();n||(0,c.redirect)("/login");let o=(0,f.createClient)("https://fjghhrubobqwplvokszz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:p}=await o.from("profiles").select("role").eq("id",n.id).single();p?.role!=="admin"&&(0,c.redirect)("/customer/dashboard");let[{count:q},{count:r},{count:s},{count:t},{count:u},{data:v},{data:w},{data:x},{data:y},{data:z}]=await Promise.all([o.from("transactions").select("*",{count:"exact",head:!0}),o.from("coin_payments").select("*",{count:"exact",head:!0}),o.from("vending_machines").select("*",{count:"exact",head:!0}),o.from("products").select("*",{count:"exact",head:!0}),o.from("organizations").select("*",{count:"exact",head:!0}),o.from("transactions").select("id, total_amount, items, payment_status, created_at, vending_machines!transactions_machine_id_fkey(name, customer_name)").order("created_at",{ascending:!1}).limit(10),o.from("transactions").select("items, total_amount, vending_machines!transactions_machine_id_fkey(customer_name)").limit(100),o.from("vending_machines").select("id, name, machine_id, customer_name, transactions!transactions_machine_id_fkey(total_amount)").limit(10),o.from("coin_payments").select("amount_in_paisa, product_id, machine_id, products(name), vending_machines(name, customer_name)").limit(100),o.from("vending_machines").select("customer_name, name")]),{data:A}=await o.from("transactions").select("total_amount, payment_status").eq("payment_status","paid"),B=A?.reduce((a,b)=>a+parseFloat(b.total_amount?.toString()||"0"),0)||0,C=(y?.reduce((a,b)=>a+(b.amount_in_paisa||0),0)||0)/100,D=B+C,E=new Map;w?.forEach(a=>{let b="string"==typeof a.items?JSON.parse(a.items):a.items||[],c=parseFloat(a.total_amount?.toString()||"0");b.forEach(a=>{let b=a.name||"Unknown",d=E.get(b);d?(d.count++,d.revenue+=c):E.set(b,{name:b,count:1,revenue:c})})}),y?.forEach(a=>{let b=a.products?.name||"Unknown",c=(a.amount_in_paisa||0)/100,d=E.get(b);d?(d.count++,d.revenue+=c):E.set(b,{name:b,count:1,revenue:c})});let F=Array.from(E.values()).sort((a,b)=>b.count-a.count).slice(0,5),G=new Map;x?.forEach(a=>{let b=a.transactions?.reduce((a,b)=>a+parseFloat(b.total_amount?.toString()||"0"),0)||0;G.set(a.name,{name:a.name,revenue:b,count:a.transactions?.length||0})}),y?.forEach(a=>{let b=a.vending_machines?.name||"Unknown",c=(a.amount_in_paisa||0)/100,d=G.get(b);d?(d.revenue+=c,d.count++):G.set(b,{name:b,revenue:c,count:1})});let H=Array.from(G.values()).sort((a,b)=>b.revenue-a.revenue),I=new Map;w?.forEach(a=>{let b=a.vending_machines?.customer_name||"Unknown",c=parseFloat(a.total_amount||0),d=I.get(b);d?(d.onlineCount++,d.onlineRevenue+=c):I.set(b,{name:b,onlineCount:1,coinCount:0,onlineRevenue:c,coinRevenue:0})}),y?.forEach(a=>{let b=a.vending_machines?.customer_name||"Unknown",c=(a.amount_in_paisa||0)/100,d=I.get(b);d?(d.coinCount++,d.coinRevenue+=c):I.set(b,{name:b,onlineCount:0,coinCount:1,onlineRevenue:0,coinRevenue:c})});let J=Array.from(I.values()).sort((a,b)=>b.onlineRevenue+b.coinRevenue-(a.onlineRevenue+a.coinRevenue)),K=new Map;z?.forEach(a=>{let b=a.customer_name||"Unknown";K.set(b,(K.get(b)||0)+1)});let L=Array.from(K.entries()).map(([a,b])=>({name:a,count:b})).sort((a,b)=>b.count-a.count);return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("header",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(d.default,{href:"/admin/dashboard",className:"p-2 hover:bg-gray-100 rounded-lg transition",children:(0,b.jsx)(g.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Comprehensive business insights and trends"})]})]})})})}),(0,b.jsxs)("main",{className:"container mx-auto px-6 py-8",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Revenue"}),(0,b.jsx)(k.DollarSign,{className:"h-5 w-5 text-green-600"})]}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:["₹",D.toFixed(2)]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-3",children:[(0,b.jsxs)("span",{className:"text-blue-600",children:["₹",B.toFixed(2)," online"]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{className:"text-amber-600",children:["₹",C.toFixed(2)," coin"]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Transactions"}),(0,b.jsx)(i.ShoppingCart,{className:"h-5 w-5 text-blue-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:(q||0)+(r||0)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-3",children:[(0,b.jsxs)("span",{className:"text-blue-600",children:[q||0," online"]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{className:"text-amber-600",children:[r||0," coin"]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Machines"}),(0,b.jsx)(l.Activity,{className:"h-5 w-5 text-purple-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:s||0}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Across ",L.length," organizations"]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Organizations"}),(0,b.jsx)(m.Building2,{className:"h-5 w-5 text-orange-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:u||0}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Customer organizations"})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8",children:[(0,b.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(m.Building2,{className:"h-5 w-5 text-purple-600"}),"Machines by Organization"]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Machine distribution across customer organizations"})]}),(0,b.jsx)("div",{className:"p-6",children:L.length>0?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg border border-purple-100",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900 truncate",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"Customer organization"})]}),(0,b.jsx)("div",{className:"ml-4 flex items-center justify-center h-12 w-12 rounded-full bg-purple-600 text-white font-bold text-lg",children:a.count})]},c))}):(0,b.jsx)("div",{className:"text-gray-500 text-center py-8",children:"No machine data available"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(j.Package,{className:"h-5 w-5 text-blue-600"}),"Top Products"]})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"space-y-3",children:F.length>0?F.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:a.name}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[a.count," sales"]})]}),(0,b.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["₹",a.revenue.toFixed(2)]})]},c)):(0,b.jsx)("div",{className:"text-gray-500 text-center py-8",children:"No product data available"})})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,b.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(l.Activity,{className:"h-5 w-5 text-purple-600"}),"Machine Transaction Chart"]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Visual comparison of machine activity"})]}),(0,b.jsx)("div",{className:"p-6",children:H.length>0?(0,b.jsx)("div",{className:"space-y-4",children:H.slice(0,10).map((a,c)=>{let d=Math.max(...H.map(a=>a.count),1),e=a.count/d*100;return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"font-medium text-gray-900 truncate max-w-[200px]",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:[a.count," txn"]}),(0,b.jsxs)("span",{className:"font-semibold text-purple-600 min-w-[70px] text-right",children:["₹",a.revenue.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"relative h-8 bg-gray-100 rounded-full overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full transition-all duration-500 flex items-center justify-end pr-3",style:{width:`${Math.max(e,5)}%`},children:e>15&&(0,b.jsx)("span",{className:"text-xs font-semibold text-white",children:a.count})}),e<=15&&(0,b.jsx)("span",{className:"absolute inset-y-0 left-2 flex items-center text-xs font-semibold text-gray-600",children:a.count})]})]},c)})}):(0,b.jsx)("div",{className:"text-gray-500 text-center py-8",children:"No machine data available"})})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8",children:[(0,b.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(m.Building2,{className:"h-5 w-5 text-indigo-600"}),"Purchase by Organization"]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Revenue breakdown by customer organization"})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Organization"}),(0,b.jsx)("th",{className:"text-center py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Online Purchases"}),(0,b.jsx)("th",{className:"text-center py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Coin Purchases"}),(0,b.jsx)("th",{className:"text-center py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Total Purchases"}),(0,b.jsx)("th",{className:"text-right py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Online Revenue"}),(0,b.jsx)("th",{className:"text-right py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Coin Revenue"}),(0,b.jsx)("th",{className:"text-right py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Total Revenue"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-100",children:J.length>0?J.map((a,c)=>{let d=a.onlineRevenue+a.coinRevenue,e=a.onlineCount+a.coinCount;return(0,b.jsxs)("tr",{className:"hover:bg-blue-50 transition-colors",children:[(0,b.jsx)("td",{className:"py-4 px-6",children:(0,b.jsx)("div",{className:"font-medium text-gray-900",children:a.name})}),(0,b.jsx)("td",{className:"py-4 px-6 text-center",children:(0,b.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:a.onlineCount})}),(0,b.jsx)("td",{className:"py-4 px-6 text-center",children:(0,b.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-800",children:a.coinCount})}),(0,b.jsx)("td",{className:"py-4 px-6 text-center",children:(0,b.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:e})}),(0,b.jsxs)("td",{className:"py-4 px-6 text-right text-blue-600 font-semibold",children:["₹",a.onlineRevenue.toFixed(2)]}),(0,b.jsxs)("td",{className:"py-4 px-6 text-right text-amber-600 font-semibold",children:["₹",a.coinRevenue.toFixed(2)]}),(0,b.jsxs)("td",{className:"py-4 px-6 text-right text-green-600 font-bold",children:["₹",d.toFixed(2)]})]},c)}):(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"text-center py-12 text-gray-500",children:"No organization data available"})})})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(h.TrendingUp,{className:"h-5 w-5 text-green-600"}),"Recent Transactions"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Date"}),(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Machine"}),(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Product"}),(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-3 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-100",children:v&&v.length>0?v.map(a=>{let c=("string"==typeof a.items?JSON.parse(a.items):a.items||[]).map(a=>a.name).join(", ")||"N/A";return(0,b.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,b.jsx)("td",{className:"py-4 px-6 text-sm text-gray-900",children:new Date(a.created_at).toLocaleDateString()}),(0,b.jsx)("td",{className:"py-4 px-6 text-sm text-gray-900",children:a.vending_machines?.name||"N/A"}),(0,b.jsx)("td",{className:"py-4 px-6 text-sm text-gray-900",children:c}),(0,b.jsxs)("td",{className:"py-4 px-6 text-sm font-semibold text-gray-900",children:["₹",parseFloat(a.total_amount||0).toFixed(2)]}),(0,b.jsx)("td",{className:"py-4 px-6",children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${"paid"===a.payment_status?"bg-green-100 text-green-700":"failed"===a.payment_status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:a.payment_status||"pending"})})]},a.id)}):(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"text-center py-12 text-gray-500",children:"No transactions found"})})})]})})]})]})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=src_app_admin_analytics_page_tsx_2381a7a2._.js.map