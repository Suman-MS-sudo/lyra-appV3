module.exports=[39292,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(95936),e=a.i(16349),f=a.i(51100),g=a.i(13743),h=a.i(40905),i=a.i(50328),j=a.i(60612),k=a.i(40020),l=a.i(36361);let m=(0,a.i(1269).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var n=a.i(11070),o=a.i(52132);async function p(){let a=await (0,e.createClient)(),{data:{user:p}}=await a.auth.getUser();p||(0,c.redirect)("/login");let q=(0,f.createClient)("https://fjghhrubobqwplvokszz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:r}=await q.from("profiles").select("role, account_type").eq("id",p.id).single();r?.role!=="admin"&&(0,c.redirect)("/customer/dashboard");let s=r?.account_type==="super_customer",t=[];if(s){let{data:a}=await q.from("vending_machines").select("id").eq("customer_id",p.id);t=a?.map(a=>a.id)||[]}let u=q.from("transactions").select(`
      *,
      profiles!transactions_customer_id_fkey (email),
      vending_machines!transactions_machine_id_fkey (name, location)
    `),v=q.from("coin_payments").select(`
      *,
      products (name),
      vending_machines (name, location)
    `),[{data:w},{data:x}]=await Promise.all([s&&t.length>0?u.in("machine_id",t).order("created_at",{ascending:!1}).limit(50):u.order("created_at",{ascending:!1}).limit(50),s&&t.length>0?v.in("machine_id",t).order("created_at",{ascending:!1}).limit(50):v.order("created_at",{ascending:!1}).limit(50)]),y=w?.reduce((a,b)=>a+parseFloat(b.total_amount||0),0)||0,z=(x?.reduce((a,b)=>a+(b.amount_in_paisa||0),0)||0)/100,A=(w?.length||0)+(x?.length||0),B=w?.filter(a=>"paid"===a.payment_status)||[],C=w?.filter(a=>"pending"===a.payment_status)||[],D=w?.filter(a=>"failed"===a.payment_status)||[],E=new Map;w?.forEach(a=>{("string"==typeof a.items?JSON.parse(a.items):a.items||[]).forEach(b=>{let c=b.name||"Unknown";E.set(c,(E.get(c)||0)+parseFloat(a.total_amount||0))})}),x?.forEach(a=>{let b=a.products?.name||"Unknown";E.set(b,(E.get(b)||0)+a.amount_in_paisa/100)});let F=Array.from(E.entries()).sort((a,b)=>b[1]-a[1]).slice(0,5),G=new Map;w?.forEach(a=>{let b=a.vending_machines?.name||"Unknown";G.set(b,(G.get(b)||0)+parseFloat(a.total_amount||0))}),x?.forEach(a=>{let b=a.vending_machines?.name||"Unknown";G.set(b,(G.get(b)||0)+a.amount_in_paisa/100)});let H=Array.from(G.entries()).sort((a,b)=>b[1]-a[1]).slice(0,5),I=Array.from({length:7},(a,b)=>{let c=new Date;return c.setDate(c.getDate()-(6-b)),c.toISOString().split("T")[0]}).map(a=>{let b=w?.filter(b=>b.created_at.startsWith(a)&&"paid"===b.payment_status)||[],c=x?.filter(b=>b.created_at.startsWith(a))||[];return{date:a,revenue:b.reduce((a,b)=>a+parseFloat(b.total_amount||0),0)+c.reduce((a,b)=>a+b.amount_in_paisa/100,0),count:b.length+c.length}}),J=Math.max(...I.map(a=>a.revenue),1);return(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50",children:[(0,b.jsx)("header",{className:"bg-white border-b shadow-sm",children:(0,b.jsx)("div",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(d.default,{href:"/admin/dashboard",className:"p-2 hover:bg-gray-100 rounded-lg transition",children:(0,b.jsx)(g.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Transactions Analytics"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Comprehensive transaction insights and trends"})]})]})})})}),(0,b.jsxs)("main",{className:"container mx-auto px-6 py-8",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Revenue"}),(0,b.jsx)(n.DollarSign,{className:"h-5 w-5 text-green-600"})]}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:["₹",(y+z).toFixed(2)]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[B.length," online + ",x?.length||0," coin"]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Total Transactions"}),(0,b.jsx)(o.ShoppingCart,{className:"h-5 w-5 text-blue-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:A}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Last 50 transactions"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Pending"}),(0,b.jsx)(l.TrendingUp,{className:"h-5 w-5 text-yellow-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:C.length}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Awaiting payment"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Failed"}),(0,b.jsx)(m,{className:"h-5 w-5 text-red-600"})]}),(0,b.jsx)("div",{className:"text-3xl font-bold text-red-600",children:D.length}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Failed payments"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-6",children:"Daily Revenue (Last 7 Days)"}),(0,b.jsx)("div",{className:"h-64 flex items-end justify-between gap-2",children:I.map((a,c)=>{let d=J>0?a.revenue/J*100:0;return(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-2",children:[(0,b.jsxs)("div",{className:"w-full flex flex-col items-center justify-end h-48 relative group",children:[(0,b.jsxs)("div",{className:"absolute -top-16 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap z-10",children:[(0,b.jsxs)("div",{className:"font-semibold",children:["₹",a.revenue.toFixed(2)]}),(0,b.jsxs)("div",{className:"text-gray-300",children:[a.count," transactions"]})]}),(0,b.jsx)("div",{className:"w-full bg-gradient-to-t from-blue-600 via-blue-500 to-purple-500 rounded-t-lg transition-all duration-500 hover:from-blue-700 hover:via-blue-600 hover:to-purple-600 cursor-pointer shadow-lg",style:{height:`${d}%`,minHeight:a.revenue>0?"8px":"0"}})]}),(0,b.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:new Date(a.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},c)})}),(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between text-xs text-gray-500",children:[(0,b.jsxs)("span",{children:["Total: ₹",I.reduce((a,b)=>a+b.revenue,0).toFixed(2)]}),(0,b.jsxs)("span",{children:[I.reduce((a,b)=>a+b.count,0)," transactions"]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-6",children:"Top Products by Revenue"}),(0,b.jsxs)("div",{className:"space-y-4",children:[F.map(([a,c],d)=>{let e=c/(F[0]?.[1]||1)*100,f=["from-emerald-500 to-green-600","from-blue-500 to-cyan-600","from-purple-500 to-pink-600","from-orange-500 to-red-600","from-yellow-500 to-amber-600"];return(0,b.jsxs)("div",{className:"group",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700 truncate flex-1",children:a}),(0,b.jsxs)("span",{className:"text-sm font-bold text-gray-900 ml-4",children:["₹",c.toFixed(2)]})]}),(0,b.jsx)("div",{className:"relative h-8 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full bg-gradient-to-r ${f[d%f.length]} rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-3 group-hover:scale-105 shadow-md`,style:{width:`${e}%`,minWidth:c>0?"60px":"0"},children:(0,b.jsxs)("span",{className:"text-xs font-semibold text-white drop-shadow",children:[(c/F.reduce((a,[,b])=>a+b,0)*100).toFixed(1),"%"]})})})]},d)}),0===F.length&&(0,b.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No product data available"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100 mb-8",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Top Machines by Revenue"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[H.map(([a,c],d)=>(0,b.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-100",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:["#",d+1]}),(0,b.jsx)("div",{className:"font-semibold text-gray-900 mb-2 truncate",children:a}),(0,b.jsxs)("div",{className:"text-xl font-bold text-blue-600",children:["₹",c.toFixed(2)]})]},d)),0===H.length&&(0,b.jsx)("div",{className:"col-span-5 text-center text-gray-500 py-4",children:"No machine data available"})]})]}),(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Search transactions by product, machine, or customer...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm"})]})}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-50 to-purple-50 border-b",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Machine"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,b.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[x&&x.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-blue-50 transition",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(j.Calendar,{className:"h-4 w-4 mr-2 text-gray-400"}),new Date(a.created_at).toLocaleString()]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center text-sm",children:[(0,b.jsx)(k.User,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,b.jsx)("div",{className:"font-medium text-gray-900",children:"Coin Payment"})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.products?.name||"Unknown"}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,b.jsx)("div",{children:a.vending_machines?.name||"Unknown"}),(0,b.jsx)("div",{className:"text-xs",children:a.vending_machines?.location})]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center text-sm font-medium text-gray-900",children:[(0,b.jsx)(i.IndianRupee,{className:"h-4 w-4 mr-1"}),(a.amount_in_paisa/100).toFixed(2)]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:"Coin"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Dispensed"})})]},`coin-${a.id}`)),w&&w.length>0?w.map(a=>{let c=("string"==typeof a.items?JSON.parse(a.items):a.items||[]).map(a=>a.name).join(", ")||"N/A";return(0,b.jsxs)("tr",{className:"hover:bg-blue-50 transition",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(j.Calendar,{className:"h-4 w-4 mr-2 text-gray-400"}),new Date(a.created_at).toLocaleString()]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center text-sm",children:[(0,b.jsx)(k.User,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,b.jsx)("div",{className:"font-medium text-gray-900",children:a.profiles?.email||"Guest"})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"text-sm font-medium text-gray-900",children:c})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.vending_machines?.name||"N/A"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center text-sm font-medium text-gray-900",children:[(0,b.jsx)(i.IndianRupee,{className:"h-4 w-4 mr-1"}),parseFloat(a.total_amount||0).toFixed(2)]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Online"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${(a=>{switch(a){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(a.payment_status||"pending")}`,children:a.payment_status||"pending"})})]},`online-${a.id}`)}):null,!w?.length&&!x?.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:"No transactions found"})})]})]})})]})]})]})}a.s(["default",()=>p],39292)}];

//# sourceMappingURL=src_app_admin_transactions_page_tsx_8e5daa8c._.js.map