module.exports=[46506,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/MachineAssignmentPopup.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/MachineAssignmentPopup.tsx <module evaluation>","default");a.s(["default",0,b])},74620,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/MachineAssignmentPopup.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/MachineAssignmentPopup.tsx","default");a.s(["default",0,b])},63136,a=>{"use strict";a.i(46506);var b=a.i(74620);a.n(b)},67351,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(16349),e=a.i(51100),f=a.i(46840),g=a.i(83627),h=a.i(95936),i=a.i(63136);async function j(){let a,j=await (0,d.createClient)(),{data:{user:k}}=await j.auth.getUser();k||(0,c.redirect)("/login");let l=(0,e.createClient)("https://fjghhrubobqwplvokszz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:m}=await l.from("profiles").select("*").eq("id",k.id).single();m?.role==="admin"&&(0,c.redirect)("/admin/dashboard");let n=m?.account_type==="super_customer",o=[];if(n&&m?.organization_id){let{data:b}=await l.from("profiles").select("id, email, full_name, account_type").eq("organization_id",m.organization_id),c=b?.map(a=>a.id)||[k.id],{data:d}=await l.from("vending_machines").select("id, name, location, status, asset_online, stock_level, customer_id").in("customer_id",c);a=d,o=b?.map(a=>{let b=d?.filter(b=>b.customer_id===a.id)||[];return{...a,machines:b,machineCount:b.length}}).filter(a=>a.machineCount>0)||[]}else{let{data:b}=await l.from("vending_machines").select("id, name, location, status, asset_online, stock_level").eq("customer_id",k.id);a=b}let p=a?.map(a=>a.id)||[],[{data:q},{data:r}]=await Promise.all([l.from("transactions").select(`
        id,
        total_amount,
        items,
        quantity,
        status,
        payment_status,
        payment_method,
        created_at,
        machine_id,
        vending_machines!transactions_machine_id_fkey (name, location)
      `).in("machine_id",p).order("created_at",{ascending:!1}),l.from("coin_payments").select(`
        id,
        amount_in_paisa,
        quantity,
        dispensed,
        created_at,
        machine_id,
        products (name),
        vending_machines (name, location)
      `).in("machine_id",p).order("created_at",{ascending:!1})]),s=a?.length||0;a?.filter(a=>"online"===a.status||"active"===a.status).length,a?.filter(a=>null!==a.stock_level&&a.stock_level<5).length;let t=(q?.length||0)+(r?.length||0),u=q?.reduce((a,b)=>"paid"===b.payment_status?a+parseFloat(b.total_amount||0):a,0)||0,v=(r?.reduce((a,b)=>a+(b.amount_in_paisa||0),0)||0)/100,w=u+v,x=a?.filter(a=>("online"===a.status||"active"===a.status)&&(a.stock_level||0)>=5)||[],y=a?.filter(a=>{let b="online"!==a.status&&"active"!==a.status,c=null!==a.stock_level&&a.stock_level<5;return b||c}).map(a=>({...a,issues:["online"!==a.status&&"active"!==a.status?"Offline":null,null!==a.stock_level&&a.stock_level<5?"Low Stock":null].filter(Boolean)}))||[],z=q?.filter(a=>"paid"===a.payment_status).length||0,A=r?.length||0;a?.map(a=>{let b=q?.filter(b=>b.machine_id===a.id&&"paid"===b.payment_status)||[],c=r?.filter(b=>b.machine_id===a.id)||[],d=b.reduce((a,b)=>a+parseFloat(b.total_amount||0),0),e=c.reduce((a,b)=>a+b.amount_in_paisa/100,0);return{...a,onlineTransactions:b.length,coinTransactions:c.length,onlineRevenue:d,coinRevenue:e,totalRevenue:d+e,totalTransactions:b.length+c.length,healthStatus:("online"===a.status||"active"===a.status)&&(a.stock_level||0)>=5?"healthy":"needs_attention"}}).sort((a,b)=>b.totalRevenue-a.totalRevenue);let B=a=>a.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2});return(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[(0,b.jsxs)("header",{className:"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-50 shadow-sm",children:[(0,b.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Lyra"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("span",{className:"text-sm text-gray-900 font-medium hidden sm:block",children:k.email}),(0,b.jsx)("form",{action:"/api/auth/logout",method:"POST",children:(0,b.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 rounded-lg transition-all shadow-sm",children:"Logout"})})]})]}),n&&(0,b.jsx)("div",{className:"px-6 py-3 border-t border-gray-200/50",children:(0,b.jsxs)("nav",{className:"flex items-center gap-2 overflow-x-auto",children:[(0,b.jsx)(h.default,{href:"/customer/dashboard",className:"px-4 py-2 rounded-lg font-medium bg-blue-100 text-blue-700",children:"Dashboard"}),(0,b.jsx)(h.default,{href:"/customer/machines",className:"px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-gray-100 transition-colors whitespace-nowrap",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Building2,{className:"w-4 h-4"}),"My Machines"]})}),(0,b.jsx)(h.default,{href:"/customer/users",className:"px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-gray-100 transition-colors whitespace-nowrap",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Users,{className:"w-4 h-4"}),"Manage Users"]})})]})})]}),(0,b.jsxs)("main",{className:"container mx-auto px-6 py-8",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Dashboard Overview"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Monitor your vending machine operations"})]}),(0,b.jsxs)("div",{className:`grid gap-4 mb-6 ${n?"grid-cols-2 lg:grid-cols-4":"grid-cols-2"}`,children:[(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Healthy Machines"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[x.length," / ",s]})]}),(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Need Attention"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:y.length})]}),n&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Online Revenue"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["₹",B(u)]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[z," transactions"]})]}),(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Coin Owed to Lyra"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["₹",B(v)]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[A," transactions"]})]})]})]}),n&&o.length>0&&(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Machine Assignments"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"View which users have machines assigned"})]}),(0,b.jsx)(h.default,{href:"/customer/users",className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg transition-all shadow-sm",children:"Manage Users"})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"User"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Email"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"Role"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"Machines"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Assigned Devices"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:o.map(a=>(0,b.jsxs)("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"py-4 px-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-9 h-9 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:(a.full_name||a.email||"U").charAt(0).toUpperCase()}),(0,b.jsx)("div",{className:"font-medium text-gray-900",children:a.full_name||"N/A"})]})}),(0,b.jsx)("td",{className:"py-4 px-4 text-sm text-gray-600",children:a.email}),(0,b.jsx)("td",{className:"py-4 px-4 text-center",children:"super_customer"===a.account_type?(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-semibold bg-purple-100 text-purple-700 rounded-full",children:"Super Customer"}):(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-700 rounded-full",children:"Customer"})}),(0,b.jsx)("td",{className:"py-4 px-4 text-center",children:(0,b.jsx)("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-700 font-semibold text-sm",children:a.machineCount})}),(0,b.jsx)("td",{className:"py-4 px-4",children:(0,b.jsx)(i.default,{machines:a.machines,userName:a.full_name||a.email})}),(0,b.jsx)("td",{className:"py-4 px-4 text-right",children:"super_customer"!==a.account_type&&(0,b.jsx)(h.default,{href:`/customer/users/${a.id}/edit`,className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:"Edit →"})})]},a.id))})]})})]}),n&&(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transaction Breakdown"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-2 px-3 text-sm font-medium text-gray-700",children:"Payment Method"}),(0,b.jsx)("th",{className:"text-right py-2 px-3 text-sm font-medium text-gray-700",children:"Count"}),(0,b.jsx)("th",{className:"text-right py-2 px-3 text-sm font-medium text-gray-700",children:"Revenue"}),(0,b.jsx)("th",{className:"text-right py-2 px-3 text-sm font-medium text-gray-700",children:"% of Total"})]})}),(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-gray-900",children:"Online Payments"}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-right text-gray-900",children:z}),(0,b.jsxs)("td",{className:"py-3 px-3 text-sm text-right font-medium text-gray-900",children:["₹",B(u)]}),(0,b.jsxs)("td",{className:"py-3 px-3 text-sm text-right text-gray-900",children:[t>0?(z/t*100).toFixed(1):0,"%"]})]}),(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-gray-900",children:"Coin Payments"}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-right text-gray-900",children:A}),(0,b.jsxs)("td",{className:"py-3 px-3 text-sm text-right font-medium text-gray-900",children:["₹",B(v)]}),(0,b.jsxs)("td",{className:"py-3 px-3 text-sm text-right text-gray-900",children:[t>0?(A/t*100).toFixed(1):0,"%"]})]}),(0,b.jsxs)("tr",{className:"bg-gray-50",children:[(0,b.jsx)("td",{className:"py-3 px-3 text-sm font-semibold text-gray-900",children:"Total"}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-right font-semibold text-gray-900",children:t}),(0,b.jsxs)("td",{className:"py-3 px-3 text-sm text-right font-semibold text-gray-900",children:["₹",B(w)]}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-right font-semibold text-gray-900",children:"100%"})]})]})]})})]}),"\\n\\n        ",(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Machines Requiring Attention",y.length>0&&(0,b.jsx)("span",{className:"ml-2 inline-block bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:y.length})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Machines with low stock or offline status"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"bg-white border border-red-200 rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"p-4 bg-red-50 border-b border-red-200",children:(0,b.jsxs)("h4",{className:"text-base font-semibold text-red-900",children:["Offline / Powered Off",(0,b.jsx)("span",{className:"ml-2 inline-block bg-red-600 text-white px-2 py-0.5 rounded-full text-xs",children:a?.filter(a=>"online"!==a.status&&"active"!==a.status).length||0})]})}),(0,b.jsx)("div",{className:"overflow-auto max-h-[400px]",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-100 sticky top-0 z-10",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Machine"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Location"}),(0,b.jsx)("th",{className:"text-center py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Status"})]})}),(0,b.jsx)("tbody",{children:(a?.filter(a=>"online"!==a.status&&"active"!==a.status).length??0)>0?a?.filter(a=>"online"!==a.status&&"active"!==a.status).map(a=>(0,b.jsxs)("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"py-3 px-3 text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-gray-600",children:a.location}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-center",children:(0,b.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:a.status})})]},a.id)):(0,b.jsx)("tr",{children:(0,b.jsxs)("td",{colSpan:3,className:"py-8 text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 text-2xl mb-1",children:"✓"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"All machines online"})]})})})]})})]}),(0,b.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"p-4 bg-orange-50 border-b border-orange-200",children:(0,b.jsxs)("h4",{className:"text-base font-semibold text-orange-900",children:["Low Stock Alert",(0,b.jsx)("span",{className:"ml-2 inline-block bg-orange-600 text-white px-2 py-0.5 rounded-full text-xs",children:a?.filter(a=>null!==a.stock_level&&a.stock_level<5).length||0})]})}),(0,b.jsx)("div",{className:"overflow-auto max-h-[400px]",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-100 sticky top-0 z-10",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Machine"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Location"}),(0,b.jsx)("th",{className:"text-right py-2 px-3 text-xs font-semibold text-gray-700 border-b border-gray-300",children:"Stock Level"})]})}),(0,b.jsx)("tbody",{children:(a?.filter(a=>null!==a.stock_level&&a.stock_level<5).length??0)>0?a?.filter(a=>null!==a.stock_level&&a.stock_level<5).sort((a,b)=>(a.stock_level||0)-(b.stock_level||0)).map(a=>(0,b.jsxs)("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"py-3 px-3 text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-gray-600",children:a.location}),(0,b.jsx)("td",{className:"py-3 px-3 text-sm text-right",children:(0,b.jsxs)("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold ${0===(a.stock_level||0)?"bg-red-100 text-red-700":3>(a.stock_level||0)?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"}`,children:[a.stock_level," units"]})})]},a.id)):(0,b.jsx)("tr",{children:(0,b.jsxs)("td",{colSpan:3,className:"py-8 text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 text-2xl mb-1",children:"✓"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"All machines have adequate stock"})]})})})]})})]})]})]})]})]})}a.s(["default",()=>j])}];

//# sourceMappingURL=src_d6a4a3c0._.js.map