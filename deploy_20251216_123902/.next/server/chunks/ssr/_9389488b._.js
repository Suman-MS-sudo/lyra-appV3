module.exports=[1269,a=>{"use strict";var b=a.i(717);let c=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:c,height:c,stroke:a,strokeWidth:g?24*Number(f)/Number(c):f,className:d("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:d(`lucide-${c(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=c(a),g};a.s(["default",()=>g],1269)},13743,a=>{"use strict";let b=(0,a.i(1269).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],13743)},37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},98847,a=>{"use strict";var b=a.i(7997),c=a.i(37936);a.i(70396);var d=a.i(73727),e=a.i(95936),f=a.i(16349),g=a.i(51100),h=a.i(13743);let i=async function(a){let b=(0,g.createClient)("https://fjghhrubobqwplvokszz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),c=a.get("email"),e=a.get("full_name"),f=a.get("organization_id"),h="on"===a.get("can_edit"),{data:i}=await b.auth.admin.listUsers(),j=i?.users.find(a=>a.email===c);if(j){await new Promise(a=>setTimeout(a,500));let{data:a}=await b.from("profiles").select("id").eq("id",j.id).single();if(a)await b.from("profiles").update({full_name:e,account_type:"customer",role:"customer",organization_id:f||null,permissions:{can_edit:h,can_view:!0}}).eq("id",j.id);else{let{error:a}=await b.from("profiles").insert({id:j.id,email:j.email,full_name:e,account_type:"customer",role:"customer",organization_id:f||null,permissions:{can_edit:h,can_view:!0}});if(a)throw Error(`Failed to create profile: ${a.message}`)}await b.auth.resetPasswordForEmail(c,{redirectTo:"https://lyra-app.co.in/auth/callback?next=/reset-password"}),(0,d.redirect)("/admin/customers");return}let k=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(a=>a.toString(16).padStart(2,"0")).join("").substring(0,16)+"Aa1!",{data:l,error:m}=await b.auth.admin.createUser({email:c,password:k,email_confirm:!0,user_metadata:{full_name:e,role:"customer",account_type:"customer"}});if(m)throw Error(m.message);await new Promise(a=>setTimeout(a,500));let{data:n}=await b.from("profiles").select("id").eq("id",l.user.id).single();if(n){let{error:a}=await b.from("profiles").update({full_name:e,account_type:"customer",role:"customer",organization_id:f||null,permissions:{can_edit:h,can_view:!0}}).eq("id",l.user.id);if(a)throw Error(a.message)}else{let{error:a}=await b.from("profiles").insert({id:l.user.id,email:l.user.email,full_name:e,account_type:"customer",role:"customer",organization_id:f||null,permissions:{can_edit:h,can_view:!0}});if(a)throw await b.auth.admin.deleteUser(l.user.id),Error(a.message)}let{error:o}=await b.auth.resetPasswordForEmail(c,{redirectTo:"https://lyra-app.co.in/auth/callback?next=/reset-password"});o&&console.error("Password reset email error:",o),(0,d.redirect)("/admin/customers")};async function j(){let a=await (0,f.createClient)(),{data:{user:c}}=await a.auth.getUser();c||(0,d.redirect)("/login");let j=(0,g.createClient)("https://fjghhrubobqwplvokszz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:k}=await j.from("profiles").select("account_type").eq("id",c.id).single();k?.account_type!=="admin"&&(0,d.redirect)("/customer/dashboard");let{data:l}=await j.from("organizations").select("id, name").order("name");return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("header",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(e.default,{href:"/admin/customers",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(h.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Customer"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Create a new customer account"})]})]})})}),(0,b.jsxs)("main",{className:"container mx-auto px-6 py-8 max-w-2xl",children:[(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,b.jsx)("strong",{children:"Note:"})," A password reset email will be automatically sent to the customer's email address. They will receive a secure link to set their password."]})}),(0,b.jsxs)("form",{action:i,className:"bg-white rounded-xl shadow-sm p-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,b.jsx)("input",{type:"email",id:"email",name:"email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"customer@example.com"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Customer will receive a password reset link at this email"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,b.jsx)("input",{type:"text",id:"full_name",name:"full_name",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"John Doe"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"organization_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Organization (Optional)"}),(0,b.jsxs)("select",{id:"organization_id",name:"organization_id",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"No Organization (Independent Customer)"}),l?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Select an organization if this customer belongs to a company"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",name:"can_edit",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Can Edit (Allow customer to make purchases)"})]}),(0,b.jsx)("p",{className:"mt-1 ml-6 text-sm text-gray-500",children:"If unchecked, customer will have read-only access"})]}),(0,b.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,b.jsx)(e.default,{href:"/admin/customers",className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-center",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Customer"})]})]})]})]})}(0,c.registerServerReference)(i,"40d161596bc1ddcdb191e323481ff94efae23b31c2",null),a.s(["$$RSC_SERVER_ACTION_0",0,i,"default",()=>j])},93585,a=>{"use strict";var b=a.i(98847);a.s([],25624),a.i(25624),a.s(["40d161596bc1ddcdb191e323481ff94efae23b31c2",()=>b.$$RSC_SERVER_ACTION_0],93585)}];

//# sourceMappingURL=_9389488b._.js.map